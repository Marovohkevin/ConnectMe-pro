<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register | ConnectMe Pro</title>
  <!-- Security Headers -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://apis.google.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data:; font-src 'self' https://fonts.gstatic.com">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta http-equiv="Strict-Transport-Security" content="max-age=63072000; includeSubDomains; preload">
  
  <style>
    :root {
      --primary: #7F5AF0;
      --primary-dark: #6C4BD1;
      --primary-light: #9B7AFF;
      --secondary: #2CB67D;
      --accent: #FF8906;
      --bg-dark: #16161A;
      --bg-darker: #0E0E10;
      --bg-card: #242629;
      --text-light: #FFFFFE;
      --text-muted: #94A1B2;
      --danger: #EF4565;
      --success: #2CB67D;
      
      --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', sans-serif;
    }
    
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    body {
      background: var(--bg-dark);
      color: var(--text-light);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      line-height: 1.6;
    }
    
    .auth-container {
      background: var(--bg-card);
      padding: 2.5rem;
      border-radius: 20px;
      width: 100%;
      max-width: 480px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      position: relative;
      z-index: 1;
      border: 1px solid rgba(255, 255, 255, 0.05);
      animation: fadeIn 0.5s forwards;
    }
    
    .app-logo {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      text-align: center;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .input-group {
      margin-bottom: 1.5rem;
      position: relative;
    }
    
    .input-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text-muted);
    }
    
    input, button, select {
      width: 100%;
      padding: 15px 20px;
      margin-bottom: 0.5rem;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      transition: var(--transition);
    }
    
    input, select {
      background: rgba(255,255,255,0.05);
      color: var(--text-light);
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(127, 90, 240, 0.2);
      background: rgba(127, 90, 240, 0.05);
    }
    
    button {
      background: var(--gradient-primary);
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      border: none;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(127, 90, 240, 0.3);
    }
    
    button:disabled {
      background: var(--text-muted);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    button.secondary {
      background: transparent;
      color: var(--primary);
      border: 2px solid var(--primary);
    }
    
    button.secondary:hover {
      background: rgba(127, 90, 240, 0.1);
    }
    
    .divider {
      margin: 1.5rem 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      position: relative;
    }
    
    .divider-text {
      position: absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-card);
      padding: 0 1rem;
      color: var(--text-muted);
      font-size: 0.9rem;
    }
    
    .error-message {
      color: var(--danger);
      font-size: 0.8rem;
      margin-top: 0.2rem;
      display: none;
    }
    
    .success-message {
      color: var(--success);
      font-size: 0.9rem;
      text-align: center;
      margin-top: 1rem;
      display: none;
    }
    
    .terms-text {
      font-size: 0.8rem;
      color: var(--text-muted);
      text-align: center;
      margin-top: 1rem;
    }
    
    .terms-text a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
    }
    
    .back-link {
      display: flex;
      align-items: center;
      color: var(--primary);
      text-decoration: none;
      margin-bottom: 1rem;
      font-weight: 500;
    }
    
    .back-link svg {
      margin-right: 5px;
    }
    
    .password-strength {
      height: 4px;
      background: rgba(255,255,255,0.1);
      border-radius: 2px;
      margin-top: 8px;
      overflow: hidden;
    }
    
    .password-strength-bar {
      height: 100%;
      width: 0;
      transition: width 0.3s ease;
    }
    
    .password-requirements {
      margin-top: 8px;
      font-size: 0.8rem;
      color: var(--text-muted);
    }
    
    .requirement {
      display: flex;
      align-items: center;
      margin-bottom: 4px;
    }
    
    .requirement-icon {
      margin-right: 6px;
      font-size: 0.7rem;
    }
    
    .requirement.valid {
      color: var(--success);
    }
    
    .loading-spinner {
      display: none;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin: 0 auto;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Responsive adjustments */
    @media (max-width: 480px) {
      .auth-container {
        padding: 1.5rem;
      }
      
      input, button, select {
        padding: 12px 16px;
      }
    }
  </style>
</head>
<body>
  <div class="auth-container">
    <a href="login.html" class="back-link">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      Back to Login
    </a>
    
    <div class="app-logo">ConnectMe Pro</div>
    
    <form id="registrationForm" novalidate>
      <div class="input-group">
        <label for="name">Full Name</label>
        <input id="name" type="text" placeholder="Your name" required autocomplete="name">
        <div id="nameError" class="error-message">Please enter your full name (2-50 characters)</div>
      </div>
      
      <div class="input-group">
        <label for="email">Email</label>
        <input id="email" type="email" placeholder="your@email.com" required autocomplete="email">
        <div id="emailError" class="error-message">Please enter a valid email address</div>
        <div id="emailExistsError" class="error-message">An account with this email already exists</div>
      </div>
      
      <div class="input-group">
        <label for="password">Password</label>
        <input id="password" type="password" placeholder="Create a password" required autocomplete="new-password" minlength="8">
        <div class="password-strength">
          <div class="password-strength-bar" id="passwordStrength"></div>
        </div>
        <div class="password-requirements">
          <div class="requirement" id="reqLength">
            <span class="requirement-icon">•</span>
            <span>At least 8 characters</span>
          </div>
          <div class="requirement" id="reqUpper">
            <span class="requirement-icon">•</span>
            <span>At least 1 uppercase letter</span>
          </div>
          <div class="requirement" id="reqLower">
            <span class="requirement-icon">•</span>
            <span>At least 1 lowercase letter</span>
          </div>
          <div class="requirement" id="reqNumber">
            <span class="requirement-icon">•</span>
            <span>At least 1 number</span>
          </div>
          <div class="requirement" id="reqSpecial">
            <span class="requirement-icon">•</span>
            <span>At least 1 special character</span>
          </div>
        </div>
        <div id="passwordError" class="error-message">Password must meet all requirements</div>
      </div>
      
      <div class="input-group">
        <label for="confirmPassword">Confirm Password</label>
        <input id="confirmPassword" type="password" placeholder="Confirm your password" required autocomplete="new-password">
        <div id="confirmError" class="error-message">Passwords don't match</div>
      </div>
      
      <div class="input-group">
        <label for="birthdate">Date of Birth</label>
        <input id="birthdate" type="date" required max="">
        <div id="ageError" class="error-message">You must be at least 18 years old</div>
      </div>
      
      <div class="input-group">
        <label for="gender">I identify as</label>
        <select id="gender" required>
          <option value="">Select gender</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
          <option value="non-binary">Non-binary</option>
          <option value="transgender">Transgender</option>
          <option value="genderqueer">Genderqueer</option>
          <option value="other">Other</option>
          <option value="prefer-not-to-say">Prefer not to say</option>
        </select>
      </div>
      
      <div class="input-group">
        <label for="role">My role</label>
        <select id="role" required>
          <option value="">Select your role</option>
          <option value="top">Top</option>
          <option value="bottom">Bottom</option>
          <option value="versatile">Versatile</option>
          <option value="side">Side</option>
        </select>
      </div>
      
      <div class="input-group">
        <label for="preference">Looking for</label>
        <select id="preference" required>
          <option value="">Select preference</option>
          <option value="top">Top</option>
          <option value="bottom">Bottom</option>
          <option value="versatile">Versatile</option>
          <option value="side">Side</option>
          <option value="no-preference">No preference</option>
        </select>
      </div>
      
      <button type="submit" id="registerButton">
        <span id="buttonText">Create Account</span>
        <span class="loading-spinner" id="spinner"></span>
      </button>
      
      <div class="terms-text">
        By registering, you agree to our <a href="/terms" target="_blank" rel="noopener noreferrer">Terms of Service</a>, 
        <a href="/privacy" target="_blank" rel="noopener noreferrer">Privacy Policy</a>, and 
        <a href="/community-guidelines" target="_blank" rel="noopener noreferrer">Community Guidelines</a>
      </div>
      
      <div class="success-message" id="successMessage">
        Registration successful! Redirecting to verification...
      </div>
    </form>
    
    <div class="divider">
      <span class="divider-text">or</span>
    </div>
    
    <button class="secondary" onclick="window.location.href='login.html'">
      Already have an account? Login
    </button>
  </div>

  <script>
    // Initialize localStorage database if it doesn't exist
    document.addEventListener('DOMContentLoaded', function() {
      if (!localStorage.getItem('connectMeUsers')) {
        localStorage.setItem('connectMeUsers', JSON.stringify([]));
      }
      
      // Set max date for birthdate (18 years ago)
      const today = new Date();
      const minDate = new Date();
      minDate.setFullYear(today.getFullYear() - 100); // 100 years ago
      const maxDate = new Date();
      maxDate.setFullYear(today.getFullYear() - 18); // 18 years ago
      
      document.getElementById('birthdate').max = maxDate.toISOString().split('T')[0];
      document.getElementById('birthdate').min = minDate.toISOString().split('T')[0];
      
      // Password strength indicator
      document.getElementById('password').addEventListener('input', function() {
        checkPasswordStrength(this.value);
      });
    });
    
    // Password strength checker
    function checkPasswordStrength(password) {
      const strengthBar = document.getElementById('passwordStrength');
      const requirements = {
        length: password.length >= 8,
        upper: /[A-Z]/.test(password),
        lower: /[a-z]/.test(password),
        number: /[0-9]/.test(password),
        special: /[^A-Za-z0-9]/.test(password)
      };
      
      // Update requirement indicators
      document.getElementById('reqLength').classList.toggle('valid', requirements.length);
      document.getElementById('reqUpper').classList.toggle('valid', requirements.upper);
      document.getElementById('reqLower').classList.toggle('valid', requirements.lower);
      document.getElementById('reqNumber').classList.toggle('valid', requirements.number);
      document.getElementById('reqSpecial').classList.toggle('valid', requirements.special);
      
      // Calculate strength score
      let score = 0;
      if (requirements.length) score += 20;
      if (requirements.upper) score += 20;
      if (requirements.lower) score += 20;
      if (requirements.number) score += 20;
      if (requirements.special) score += 20;
      
      // Update strength bar
      strengthBar.style.width = score + '%';
      
      if (score < 40) {
        strengthBar.style.background = 'var(--danger)';
      } else if (score < 80) {
        strengthBar.style.background = 'var(--accent)';
      } else {
        strengthBar.style.background = 'var(--success)';
      }
      
      return score === 100; // Returns true if all requirements are met
    }
    
    // Check if email already exists
    function checkEmailExists(email) {
      const users = JSON.parse(localStorage.getItem('connectMeUsers'));
      return users.some(user => user.email.toLowerCase() === email.toLowerCase());
    }
    
    // Generate a simple user ID
    function generateUserId() {
      return 'user_' + Math.random().toString(36).substr(2, 9);
    }
    
    // Hash password (in a real app, this would be done server-side with proper hashing)
    function simpleHash(password) {
      let hash = 0;
      for (let i = 0; i < password.length; i++) {
        const char = password.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash; // Convert to 32bit integer
      }
      return hash.toString();
    }
    
    // Form validation
    document.getElementById('registrationForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Reset errors
      document.querySelectorAll('.error-message').forEach(el => {
        el.style.display = 'none';
      });
      
      // Get form values
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const birthdate = document.getElementById('birthdate').value;
      const gender = document.getElementById('gender').value;
      const role = document.getElementById('role').value;
      const preference = document.getElementById('preference').value;
      
      let isValid = true;
      
      // Name validation
      if (!name || name.length < 2 || name.length > 50) {
        document.getElementById('nameError').style.display = 'block';
        isValid = false;
      }
      
      // Email validation
      if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        document.getElementById('emailError').style.display = 'block';
        isValid = false;
      } else if (checkEmailExists(email)) {
        document.getElementById('emailExistsError').style.display = 'block';
        isValid = false;
      }
      
      // Password validation
      const isPasswordStrong = checkPasswordStrength(password);
      if (!password || !isPasswordStrong) {
        document.getElementById('passwordError').style.display = 'block';
        isValid = false;
      }
      
      // Confirm password
      if (password !== confirmPassword) {
        document.getElementById('confirmError').style.display = 'block';
        isValid = false;
      }
      
      // Age validation
      if (!birthdate) {
        document.getElementById('ageError').style.display = 'block';
        isValid = false;
      }
      
      // Gender validation
      if (!gender) {
        isValid = false;
      }
      
      // Role validation
      if (!role) {
        isValid = false;
      }
      
      // Preference validation
      if (!preference) {
        isValid = false;
      }
      
      if (isValid) {
        // Show loading state
        const button = document.getElementById('registerButton');
        const buttonText = document.getElementById('buttonText');
        const spinner = document.getElementById('spinner');
        
        button.disabled = true;
        buttonText.textContent = 'Creating account...';
        spinner.style.display = 'block';
        
        // Prepare user data
        const userData = {
          id: generateUserId(),
          name,
          email,
          passwordHash: simpleHash(password), // In a real app, NEVER store plain text passwords
          birthdate,
          gender,
          role,
          preference,
          agreeToTerms: true,
          createdAt: new Date().toISOString(),
          verified: false,
          lastLogin: null,
          profileComplete: false
        };
        
        // Store user data in localStorage
        registerWithLocalStorage(userData);
      }
    });
    
    // Register user with localStorage
    function registerWithLocalStorage(userData) {
      try {
        // Get current users from localStorage
        const users = JSON.parse(localStorage.getItem('connectMeUsers'));
        
        // Add new user
        users.push(userData);
        
        // Save back to localStorage
        localStorage.setItem('connectMeUsers', JSON.stringify(users));
        
        // Also store the current user session
        localStorage.setItem('currentUser', JSON.stringify({
          id: userData.id,
          email: userData.email,
          name: userData.name,
          verified: userData.verified
        }));
        
        // Hide loading state
        document.getElementById('buttonText').textContent = 'Create Account';
        document.getElementById('spinner').style.display = 'none';
        document.getElementById('registerButton').disabled = false;
        
        // Show success message
        document.getElementById('successMessage').style.display = 'block';
        
        // Redirect after 2 seconds
        setTimeout(() => {
          window.location.href = 'verify-email.html?email=' + encodeURIComponent(userData.email);
        }, 2000);
        
      } catch (error) {
        console.error('Registration error:', error);
        
        // Hide loading state
        document.getElementById('buttonText').textContent = 'Create Account';
        document.getElementById('spinner').style.display = 'none';
        document.getElementById('registerButton').disabled = false;
        
        // Show error to user
        alert('Registration failed. Please try again.');
      }
    }
    
    // Additional functions that would be useful for a real app
    
    // Check if user is logged in (for other pages)
    function checkAuth() {
      return localStorage.getItem('currentUser') !== null;
    }
    
    // Get current user data
    function getCurrentUser() {
      const user = localStorage.getItem('currentUser');
      return user ? JSON.parse(user) : null;
    }
    
    // Logout function
    function logout() {
      localStorage.removeItem('currentUser');
      window.location.href = 'login.html';
    }
    
    // Get user by email (for login)
    function getUserByEmail(email) {
      const users = JSON.parse(localStorage.getItem('connectMeUsers'));
      return users.find(user => user.email.toLowerCase() === email.toLowerCase());
    }
  </script>
</body>
</html>
